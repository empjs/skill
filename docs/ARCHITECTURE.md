# EMP Skill Platform - ç³»ç»Ÿæ¶æ„è®¾è®¡

## ğŸ—ï¸ æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    EMP Skill Platform æ¶æ„                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              CLI å±‚ï¼ˆpackages/eskill/ï¼‰                â”‚    â”‚
â”‚  â”‚  â”œâ”€ å®Œå…¨ç‹¬ç«‹è¿è¡Œ                                         â”‚    â”‚
â”‚  â”‚  â”œâ”€ çº¯æœ¬åœ°æ“ä½œ                                           â”‚    â”‚
â”‚  â”‚  â”œâ”€ é›¶é—¨æ§›å®‰è£…                                           â”‚    â”‚
â”‚  â”‚  â””â”€ å¯é€‰é¥æµ‹                                              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                               â”‚                                  â”‚
â”‚                               â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚             Web å¹³å°å±‚ï¼ˆapps/web/ï¼‰                     â”‚    â”‚
â”‚  â”‚  â”œâ”€ TanStack Start (React 19)                          â”‚    â”‚
â”‚  â”‚  â”œâ”€ Tailwind CSS v4                                     â”‚    â”‚
â”‚  â”‚  â”œâ”€ Cloudflare Pages                                    â”‚    â”‚
â”‚  â”‚  â””â”€ Cloudflare D1                                       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                               â”‚                                  â”‚
â”‚                               â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚             æ•°æ®æºå±‚                                        â”‚    â”‚
â”‚  â”‚  â”œâ”€ NPM Registry                                        â”‚    â”‚
â”‚  â”‚  â”œâ”€ GitHub API                                          â”‚    â”‚
â”‚  â”‚  â””â”€ æŠ€èƒ½ç›®å½•çˆ¬è™«                                           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚             ç¤¾åŒºäº’åŠ¨å±‚                                      â”‚    â”‚
â”‚  â”‚  â”œâ”€ OAuth è®¤è¯ï¼ˆGoogle/GitHubï¼‰                         â”‚    â”‚
â”‚  â”‚  â”œâ”€ ç‚¹èµæ”¶è—ç³»ç»Ÿ                                         â”‚    â”‚
â”‚  â”‚  â””â”€ ç”¨æˆ·å…³ç³»ç½‘ç»œ                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ—‚ï¸ æ•°æ®æµè®¾è®¡

### æŠ€èƒ½å‘å¸ƒæµç¨‹

```mermaid
graph TD
    A[å¼€å‘è€…åˆ›å»º GitHub ä»“åº“] --> B[æäº¤ä»£ç åˆ° GitHub]
    B --> C[ç³»ç»Ÿè‡ªåŠ¨å‘ç°]
    C --> D[éªŒè¯ NPM åŒ…]
    D --> E[çˆ¬è™«æŠ“å–ä¿¡æ¯]
    E --> F[å†™å…¥æ•°æ®åº“]
    F --> G[å±•ç¤ºåœ¨å¹³å°]
    G --> H[ç”¨æˆ·å‘ç°å’Œå®‰è£…]
```

### ç”¨æˆ·ä½¿ç”¨æµç¨‹

```mermaid
graph TD
    A[ç”¨æˆ·è®¿é—®å¹³å°] --> B[æµè§ˆæŠ€èƒ½]
    B --> C[é€‰æ‹©æ„Ÿå…´è¶£æŠ€èƒ½]
    C --> D{éœ€è¦ç™»å½•?}
    D -->|å¦| E[ç›´æ¥å®‰è£… CLI]
    D -->|æ˜¯| F[OAuth ç™»å½•]
    F --> G[ç‚¹èµ/æ”¶è—]
    G --> H[å®‰è£…æŠ€èƒ½]
    H --> I[CLI ç®¡ç†]
```

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### æ ¸å¿ƒè¡¨ç»“æ„

#### users è¡¨ï¼ˆç”¨æˆ·è¡¨ï¼‰
```sql
CREATE TABLE users (
  id TEXT PRIMARY KEY,
  name TEXT NOT NULL,
  avatar TEXT,
  provider TEXT NOT NULL,           -- 'google' | 'github'
  provider_id TEXT NOT NULL UNIQUE, -- OAuth ç”¨æˆ· ID
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

#### skills è¡¨ï¼ˆæŠ€èƒ½è¡¨ï¼‰
```sql
CREATE TABLE skills (
  id TEXT PRIMARY KEY,
  npm_package TEXT UNIQUE,           -- NPM åŒ…å
  github_repo TEXT UNIQUE,           -- GitHub ä»“åº“
  github_owner TEXT NOT NULL,
  name TEXT NOT NULL,
  slug TEXT UNIQUE NOT NULL,
  description TEXT NOT NULL,
  category TEXT,                     -- æŠ€èƒ½åˆ†ç±»
  tags TEXT,                        -- JSON æ ‡ç­¾æ•°ç»„
  downloads INTEGER DEFAULT 0,       -- NPM ä¸‹è½½é‡
  github_stars INTEGER DEFAULT 0,    -- GitHub Star æ•°
  likes_count INTEGER DEFAULT 0,     -- ç‚¹èµæ•°
  favorites_count INTEGER DEFAULT 0, -- æ”¶è—æ•°
  last_synced_at DATETIME,           -- æœ€ååŒæ­¥æ—¶é—´
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

#### likes è¡¨ï¼ˆç‚¹èµè¡¨ï¼‰
```sql
CREATE TABLE likes (
  user_id TEXT NOT NULL,
  skill_id TEXT NOT NULL,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (user_id, skill_id),
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
  FOREIGN KEY (skill_id) REFERENCES skills(id) ON DELETE CASCADE
);
```

#### favorites è¡¨ï¼ˆæ”¶è—è¡¨ï¼‰
```sql
CREATE TABLE favorites (
  user_id TEXT NOT NULL,
  skill_id TEXT NOT NULL,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (user_id, skill_id),
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
  FOREIGN KEY (skill_id) REFERENCES skills(id) ON DELETE CASCADE
);
```

#### sessions è¡¨ï¼ˆSession è¡¨ï¼‰
```sql
CREATE TABLE sessions (
  id TEXT PRIMARY KEY,
  user_id TEXT NOT NULL,
  expires_at DATETIME NOT NULL,
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);
```

### ç´¢å¼•ä¼˜åŒ–

```sql
-- æŠ€èƒ½æŸ¥è¯¢ä¼˜åŒ–
CREATE INDEX idx_skills_slug ON skills(slug);
CREATE INDEX idx_skills_category ON skills(category);
CREATE INDEX idx_skills_downloads ON skills(downloads DESC);
CREATE INDEX idx_skills_likes_count ON skills(likes_count DESC);

-- ç”¨æˆ·äº’åŠ¨ä¼˜åŒ–
CREATE INDEX idx_likes_user ON likes(user_id);
CREATE INDEX idx_likes_skill ON likes(skill_id);
CREATE INDEX idx_favorites_user ON favorites(user_id);
CREATE INDEX idx_favorites_skill ON favorites(skill_id);

-- Session ç®¡ç†ä¼˜åŒ–
CREATE INDEX idx_sessions_user ON sessions(user_id);
CREATE INDEX idx_sessions_expires ON sessions(expires_at);
```

## ğŸ”„ API è®¾è®¡

### å…¬å¼€ APIï¼ˆæ— éœ€è®¤è¯ï¼‰

#### æŠ€èƒ½æŸ¥è¯¢
```typescript
GET /api/skills              // æŠ€èƒ½åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰
GET /api/skills/:slug        // æŠ€èƒ½è¯¦æƒ…
GET /api/search              // æœç´¢æŠ€èƒ½
GET /api/categories          // åˆ†ç±»åˆ—è¡¨
GET /api/skills/:slug/likes  // ç‚¹èµç”¨æˆ·åˆ—è¡¨
```

#### å“åº”æ ¼å¼
```typescript
interface SkillsResponse {
  skills: Skill[]
  pagination: {
    page: number
    limit: number
    total: number
    hasMore: boolean
  }
  filters: {
    categories: string[]
    totalCount: number
  }
}
```

### ç§æœ‰ APIï¼ˆéœ€è¦è®¤è¯ï¼‰

#### ç”¨æˆ·è®¤è¯
```typescript
GET  /api/auth/google        // Google OAuth ç™»å½•
GET  /api/auth/github        // GitHub OAuth ç™»å½•
GET  /api/auth/callback/:provider  // OAuth å›è°ƒå¤„ç†
GET  /api/auth/me            // å½“å‰ç”¨æˆ·ä¿¡æ¯
POST /api/auth/logout        // é€€å‡ºç™»å½•
```

#### ç”¨æˆ·äº’åŠ¨
```typescript
POST   /api/skills/:slug/like        // ç‚¹èµæŠ€èƒ½
DELETE /api/skills/:slug/like        // å–æ¶ˆç‚¹èµ
POST   /api/skills/:slug/favorite    // æ”¶è—æŠ€èƒ½
DELETE /api/skills/:slug/favorite    // å–æ¶ˆæ”¶è—
GET    /api/favorites                // ç”¨æˆ·æ”¶è—åˆ—è¡¨
```

## ğŸ” å®‰å…¨è®¾è®¡

### æ•°æ®æ¥æºéªŒè¯

```typescript
// æŠ€èƒ½æ¥æºéªŒè¯è§„åˆ™
function validateSkillSource(source: SkillSource): ValidationResult {
  if (source.type === 'npm') {
    // NPM åŒ…éªŒè¯
    return /^@[\w-]+\/[\w-]+$/.test(source.identifier) ||
           /^[\w-]+$/.test(source.identifier)
  }

  if (source.type === 'github') {
    // GitHub ä»“åº“éªŒè¯
    return /^[\w-]+\/[\w-]+$/.test(source.identifier)
  }

  return { valid: false, reason: 'ä¸æ”¯æŒçš„æ•°æ®æº' }
}
```

### OAuth å®‰å…¨æªæ–½

- âœ… HTTPS å¼ºåˆ¶ä½¿ç”¨
- âœ… State å‚æ•°éªŒè¯
- âœ… Token åŠ å¯†å­˜å‚¨
- âœ… Session è¿‡æœŸæ—¶é—´
- âœ… CORS é™åˆ¶
- âœ… Rate Limiting

### æ•°æ®éšç§ä¿æŠ¤

- âœ… åŒ¿åé¥æµ‹ï¼ˆå¯é€‰ï¼‰
- âœ… ä¸æ”¶é›†ä½¿ç”¨è¡Œä¸º
- âœ… ä¸è®°å½• IP åœ°å€
- âœ… ç”¨æˆ·å¯åˆ é™¤æ•°æ®
- âœ… æœ€å°åŒ–æ•°æ®æ”¶é›†

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### å‰ç«¯ä¼˜åŒ–

#### 1. ä»£ç åˆ†å‰²
```typescript
// è·¯ç”±çº§ä»£ç åˆ†å‰²
const SkillDetail = lazy(() => import('./routes/skills.$slug'))
```

#### 2. ç¼“å­˜ç­–ç•¥
```typescript
// React Query ç¼“å­˜
const skillsQuery = queryOptions({
  queryKey: ['skills'],
  queryFn: fetchSkills,
  staleTime: 5 * 60 * 1000,  // 5 åˆ†é’Ÿ
  gcTime: 10 * 60 * 1000,    // 10 åˆ†é’Ÿ
})
```

### åç«¯ä¼˜åŒ–

#### 1. æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–
```sql
-- åˆ†é¡µæŸ¥è¯¢ä¼˜åŒ–
SELECT * FROM skills
WHERE category = ?
ORDER BY downloads DESC
LIMIT ? OFFSET ?
```

#### 2. KV ç¼“å­˜
```typescript
// ç¼“å­˜çƒ­é—¨æŠ€èƒ½
async function getPopularSkills(env: Env) {
  const cacheKey = 'popular-skills'
  let skills = await env.CACHE.get(cacheKey, 'json')

  if (!skills) {
    skills = await env.DB.prepare('SELECT * FROM skills ORDER BY downloads DESC LIMIT 10').all()
    await env.CACHE.put(cacheKey, JSON.stringify(skills), { expirationTtl: 3600 })
  }

  return skills
}
```

#### 3. Edge Computing
```typescript
// Cloudflare Workers è¾¹ç¼˜è®¡ç®—
export default {
  async fetch(request: Request, env: Env) {
    // åœ¨è¾¹ç¼˜å¤„ç†è¯·æ±‚
    const url = new URL(request.url)

    if (url.pathname === '/api/skills') {
      return handleSkillsRequest(request, env)
    }

    return new Response('Not Found', { status: 404 })
  }
}
```

## ğŸ”„ çˆ¬è™«ç³»ç»Ÿè®¾è®¡

### çˆ¬è™«æ¶æ„

```typescript
class SkillsCrawler {
  private baseUrl = 'https://example.com/skills'

  async crawlSkillsSh(): Promise<void> {
    // 1. è·å–æ’è¡Œæ¦œé¡µé¢
    const html = await this.fetchPage('/')

    // 2. è§£ææŠ€èƒ½åˆ—è¡¨
    const skills = this.parseLeaderboard(html)

    // 3. é€ä¸ªå¤„ç†æŠ€èƒ½
    for (const skill of skills) {
      try {
        await this.processSkill(skill)
      } catch (error) {
        console.error(`Failed to process ${skill.name}:`, error)
      }
    }
  }

  private async processSkill(skill: CrawledSkill): Promise<void> {
    // 1. éªŒè¯ GitHub ä»“åº“
    const repoInfo = await this.validateGitHubRepo(skill.repo)

    // 2. æŸ¥æ‰¾ NPM åŒ…
    const npmPackage = await this.findNPMPackage(skill.repo)

    // 3. è·å– NPM æ•°æ®
    const npmData = await this.fetchNPMData(npmPackage)

    // 4. å­˜å‚¨åˆ°æ•°æ®åº“
    await this.saveSkill({
      ...repoInfo,
      npm_package: npmPackage,
      downloads: npmData.downloads,
      installs: skill.installs,
    })
  }
}
```

### å®šæ—¶ä»»åŠ¡é…ç½®

```toml
# wrangler.toml
[triggers]
crons = [
  # æ¯å¤©å‡Œæ™¨ 3 ç‚¹çˆ¬å–æŠ€èƒ½ç›®å½•
  "0 3 * * *",
  # æ¯å°æ—¶åŒæ­¥ NPM ä¸‹è½½é‡
  "0 * * * *",
  # æ¯å‘¨æ—¥å‡Œæ™¨ 4 ç‚¹æ·±åº¦åŒæ­¥
  "0 4 * * 0"
]
```

## ğŸ“ˆ å¯æ‰©å±•æ€§è®¾è®¡

### æ¨¡å—åŒ–æ¶æ„

#### 1. æ’ä»¶ç³»ç»Ÿ
```typescript
interface SkillPlugin {
  name: string
  version: string
  setup: (app: App) => void
  cleanup?: () => void
}

// æ’ä»¶æ³¨å†Œ
const plugins: SkillPlugin[] = [
  new OAuthPlugin(),
  new AnalyticsPlugin(),
  new SearchPlugin(),
]

plugins.forEach(plugin => plugin.setup(app))
```

#### 2. é’©å­ç³»ç»Ÿ
```typescript
interface Hooks {
  beforeSkillInstall: (skill: Skill) => Promise<void>
  afterSkillInstall: (skill: Skill, result: InstallResult) => Promise<void>
  onUserLogin: (user: User) => Promise<void>
  onSkillLike: (user: User, skill: Skill) => Promise<void>
}

// é’©å­ä½¿ç”¨
await hooks.beforeSkillInstall(skill)
await installSkill(skill)
await hooks.afterSkillInstall(skill, result)
```

### å¤šç§Ÿæˆ·æ”¯æŒ

#### 1. ç»„ç»‡éš”ç¦»
```typescript
interface Organization {
  id: string
  name: string
  domain: string
  settings: OrgSettings
}

// æŒ‰ç»„ç»‡éš”ç¦»æ•°æ®
const orgSkills = await db.prepare(
  'SELECT * FROM skills WHERE org_id = ?',
  [orgId]
)
```

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•
```typescript
// CLI æµ‹è¯•
describe('install command', () => {
  it('should install skill from GitHub', async () => {
    const result = await installCommand('vercel-labs/agent-skills')
    expect(result.success).toBe(true)
    expect(result.skill).toBeDefined()
  })
})
```

### é›†æˆæµ‹è¯•
```typescript
// API æµ‹è¯•
describe('skills API', () => {
  it('should return skills list', async () => {
    const response = await request(app)
      .get('/api/skills')
      .expect(200)

    expect(Array.isArray(response.body.skills)).toBe(true)
  })
})
```

### E2E æµ‹è¯•
```typescript
// Playwright æµ‹è¯•
test('user can browse skills', async ({ page }) => {
  await page.goto('/')
  await page.click('[data-testid="skill-card"]')
  await expect(page).toHaveURL(/\/skills\/.+/)
})
```

## ğŸ“‹ æ€»ç»“

EMP Skill Platform çš„æ¶æ„è®¾è®¡éµå¾ªä»¥ä¸‹åŸåˆ™ï¼š

1. **åˆ†å±‚æ¶æ„** - CLIã€Webã€æ•°æ®æºã€ç¤¾åŒºå±‚çš„æ¸…æ™°åˆ†ç¦»
2. **å®‰å…¨ä¼˜å…ˆ** - ä¸¥æ ¼çš„æ•°æ®æºéªŒè¯å’Œéšç§ä¿æŠ¤
3. **æ€§èƒ½ä¼˜åŒ–** - å¤šå±‚æ¬¡çš„ç¼“å­˜å’ŒæŸ¥è¯¢ä¼˜åŒ–
4. **å¯æ‰©å±•æ€§** - æ’ä»¶ç³»ç»Ÿå’Œé’©å­æœºåˆ¶
5. **ç”¨æˆ·ä½“éªŒ** - æ¸è¿›å¼ç™»å½•å’Œé›¶é—¨æ§›ä½¿ç”¨

è¿™ç§è®¾è®¡ç¡®ä¿äº†ç³»ç»Ÿçš„ç¨³å®šã€å¯ç»´æŠ¤å’Œå¯æ‰©å±•ï¼Œä¸ºæœªæ¥çš„åŠŸèƒ½æ‰©å±•å¥ å®šäº†åšå®çš„åŸºç¡€ã€‚